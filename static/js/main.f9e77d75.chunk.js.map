{"version":3,"sources":["../../src/hocs/symbols.js","../../src/hocs/withObservable.js","../../src/hooks/useObserver.js","pages/Api.js","../../src/hooks/withHookObserversNotify.js","pages/Home.js","../../src/hooks/useObserversNotify.js","pages/example/Example.js","pages/example/example-list.js","pages/example/index.js","pages/App.js","index.js"],"names":["Symbol","withObservable","Component","SYMBOLS","uuid","c","crypto","Uint8Array","deepDiff","object","base","transform","result","value","key","isEqual","Object","isObject","useObserver","diff","useState","setValue","useEffect","id","observable","values","isSingleField","fields","newValues","get","pick","this","previousValues","initialValue","hook","test","Proxy","Reflect","set","apply","name","args","watcher","Counter","defaultValue","count","setCount","onClick","CounterWatcher","first","second","Home","data","useObserversNotify","Example","example","src","codeSandboxId","style","width","height","border","borderRadius","overflow","title","allow","sandbox","path","Examples","exampleList","map","e","Title","Typography","Content","Layout","Sider","App","history","useHistory","theme","level","textAlign","mode","onSelect","push","Item","SubMenu","className","Api","ReactDOM","render","hashType","document","getElementById"],"mappings":"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","file":"static/js/main.f9e77d75.chunk.js","sourcesContent":["export default {\n  INSTANCES: Symbol('instances'),\n  OBSERVERS: Symbol('observers')\n}\n","import SYMBOLS from './symbols'\n\nfunction uuidv4() {\n  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>\n    (\n      c ^\n      (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))\n    ).toString(16)\n  )\n}\n\nexport default function withObservable(Component) {\n  Component[SYMBOLS.OBSERVERS] = new Map()\n\n  Component.getObservers = () => Component[SYMBOLS.OBSERVERS]\n\n  Component.hasObserver = (key) => Component.getObservers().has(key)\n  Component.getObserver = (key) =>\n    Component.hasObserver(key) ? Component.getObservers().get(key) : new Map()\n\n  Component.addObserver = (key, watcher) => {\n    if (!Component.hasObserver(key)) {\n      Component.getObservers().set(key, new Map())\n    }\n\n    const uuid = uuidv4()\n    Component.getObserver(key).set(uuid, watcher)\n\n    return uuid\n  }\n\n  Component.removeObserver = (key, id) => {\n    if (Component.hasObserver(key)) {\n      Component.getObserver(key).delete(id)\n    }\n  }\n\n  return Component\n}\n","import { useState, useEffect } from 'react'\nimport { pick, get, isEqual, transform, isObject } from 'lodash'\n\nexport function deepDiff(object, base) {\n  if (typeof object !== typeof base) {\n    return object\n  }\n\n  return transform(object, function a(result, value, key) {\n    if (!isEqual(value, base[key])) {\n      Object.assign(result, {\n        [key]:\n          isObject(value) && isObject(base[key])\n            ? deepDiff(value, base[key])\n            : value\n      })\n    }\n  })\n}\n\nexport default function useObserver(\n  observable,\n  name,\n  fields,\n  initialValue,\n  diff = deepDiff\n) {\n  const [value, setValue] = useState(initialValue)\n\n  useEffect(() => {\n    const id = observable.addObserver(\n      name,\n      function observer(values) {\n        if (fields) {\n          const isSingleField = typeof fields === 'string'\n          const newValues = isSingleField\n            ? get(values, fields)\n            : pick(values, fields)\n          const isDiff = isSingleField\n            ? !isEqual(newValues, this.previousValues)\n            : Object.keys(diff(newValues, this.previousValues)).length !== 0\n          if (isDiff) {\n            setValue(newValues)\n          }\n          this.previousValues = newValues\n        } else {\n          if (values !== value) {\n            setValue(values)\n          }\n          this.previousValues = values\n        }\n      }.bind({ previousValues: initialValue })\n    )\n\n    return () => {\n      observable.removeObserver(name, id)\n    }\n  }, [])\n\n  return value\n}\n","import React, { useState } from 'react'\nimport { useObserver, withHookObserversNotify } from 'react-instances'\n\nconst test = withHookObserversNotify(useState)\n\nconst Counter = ({ name, defaultValue = 0 }) => {\n  const [count, setCount] = test(`${name}-count`, defaultValue)\n\n  const increase = () => {\n    setCount(count + 1)\n  }\n  const decrease = () => {\n    setCount(count - 1)\n  }\n\n  return (\n    <div>\n      <button onClick={() => decrease()}>-</button>\n      {count}\n      <button onClick={() => increase()}>+</button>\n    </div>\n  )\n}\n\nconst CounterWatcher = () => {\n  const [first] = useObserver(test, 'myFirstCounter-count') ?? []\n  const [second] = useObserver(test, 'mySecondCounter-count') ?? []\n\n  return (\n    <>\n      First counter value: {first} and second counter value: {second}\n    </>\n  )\n}\n\nconst Home = () => {\n  return (\n    <>\n      <Counter name='myFirstCounter' />\n      <Counter name='mySecondCounter' />\n      <CounterWatcher />\n    </>\n  )\n}\n\nexport default Home\n","import { useEffect } from 'react'\nimport { withObservable } from '..'\n\nexport default function withHookObserversNotify(hook) {\n  withObservable(hook)\n\n  return new Proxy(hook, {\n    get: Reflect.get,\n    set: Reflect.set,\n    apply(target, thisArgument, [name, ...args]) {\n      const result = Reflect.apply(target, thisArgument, args)\n      useEffect(() => {\n        hook.getObserver(name).forEach((watcher) => watcher(result))\n      }, [result])\n\n      return result\n    }\n  })\n}\n","import React, { useState } from 'react'\r\nimport {\r\n  withObservable,\r\n  useObserver,\r\n  useObserversNotify\r\n} from 'react-instances'\r\n\r\nconst Counter = withObservable(({ name, defaultValue = 0 }) => {\r\n  const [count, setCount] = useState(defaultValue)\r\n\r\n  const increase = () => {\r\n    setCount(count + 1)\r\n  }\r\n  const decrease = () => {\r\n    setCount(count - 1)\r\n  }\r\n\r\n  useObserversNotify(Counter, name, { count })\r\n\r\n  return (\r\n    <div>\r\n      <button onClick={() => decrease()}>-</button>\r\n      {count}\r\n      <button onClick={() => increase()}>+</button>\r\n    </div>\r\n  )\r\n})\r\n\r\nconst CounterWatcher = () => {\r\n  const first = useObserver(Counter, 'myFirstCounter', 'count', 0)\r\n  const second = useObserver(Counter, 'mySecondCounter', 'count', 0)\r\n\r\n  return (\r\n    <>\r\n      First counter value: {first} and second counter value: {second}\r\n    </>\r\n  )\r\n}\r\n\r\nconst Home = () => {\r\n  return (\r\n    <>\r\n      <Counter name='myFirstCounter' />\r\n      <Counter name='mySecondCounter' />\r\n      <CounterWatcher />\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Home\r\n","import { useEffect } from 'react'\n\nexport default function useObserversNotify(Component, name, ...data) {\n  useEffect(() => {\n    const values = Object.assign({}, ...data)\n    Component.getObserver(name).forEach((watcher) => watcher(values))\n  }, [...data])\n}\n","import React from 'react'\n\nconst Example = ({ example }) => {\n  return (\n    <iframe\n      src={`https://codesandbox.io/embed/react-instances-example-${example.codeSandboxId}?autoresize=1&fontsize=14&hidenavigation=1&theme=light`}\n      style={{\n        width: '100%',\n        height: '100%',\n        border: 0,\n        borderRadius: 4,\n        overflow: 'hidden'\n      }}\n      title='react-instances-example'\n      allow='accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking'\n      sandbox='allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts'\n    />\n  )\n}\n\nexport default Example\n","export default [\n  {\n    name: 'Basic',\n    path: '/basic',\n    codeSandboxId: 'psu2e'\n  },\n  {\n    name: 'Custom prop name',\n    path: '/custom-prop-name',\n    codeSandboxId: '6sfkm'\n  },\n  {\n    name: 'Manage existing class component',\n    path: '/exist-cc',\n    codeSandboxId: 'rnlh7'\n  },\n  {\n    name: 'Manage hook instance',\n    path: '/manage-hook',\n    codeSandboxId: 'cd47x'\n  },\n  {\n    name: 'Manage function component',\n    path: '/manage-func-comp',\n    codeSandboxId: 'vq19d'\n  },\n  {\n    name: 'Observer function component',\n    path: '/observer-func-comp',\n    codeSandboxId: '328vk'\n  },\n  {\n    name: 'Observer hook',\n    path: '/observer-hook',\n    codeSandboxId: 'flqq1'\n  }\n]\n","import React from 'react'\nimport { Switch, Route } from 'react-router-dom'\nimport Example from './Example'\n\nimport exampleList from './example-list'\n\nconst Examples = () => (\n  <Switch>\n    {exampleList.map((e) => (\n      <Route path={`/example${e.path}`} key={e.path}>\n        <Example example={e} />\n      </Route>\n    ))}\n  </Switch>\n)\n\nexport default Examples\n","import React from 'react'\nimport { Switch, Route, useHistory } from 'react-router-dom'\nimport { Layout, Menu, Typography } from 'antd'\n\nimport Api from './Api'\nimport Home from './Home'\nimport Examples from './example'\nimport exampleList from './example/example-list'\n\nconst { Title } = Typography\nconst { Content, Sider } = Layout\n\nexport default function App() {\n  const history = useHistory()\n\n  return (\n    <Layout style={{ height: '100%' }}>\n      <Sider\n        theme='light'\n        width={300}\n        style={{\n          overflow: 'auto',\n          height: '100%'\n        }}\n      >\n        <Title level={3} style={{ textAlign: 'center' }}>\n          react-instances\n        </Title>\n        <Menu\n          theme='light'\n          mode='inline'\n          onSelect={({ key }) => history.push(key)}\n        >\n          <Menu.Item key='/'>Home</Menu.Item>\n          <Menu.Item key='/api'>API</Menu.Item>\n          <Menu.SubMenu key='examples' title='Examples'>\n            {exampleList.map((e) => (\n              <Menu.Item key={`/example${e.path}`}>{e.name}</Menu.Item>\n            ))}\n          </Menu.SubMenu>\n        </Menu>\n      </Sider>\n      <Layout className='site-layout' style={{ width: 'auto', height: '100%' }}>\n        <Content style={{ overflow: 'initial', height: '100%' }}>\n          <div\n            className='site-layout-background'\n            style={{ textAlign: 'center', height: '100%' }}\n          >\n            <Switch>\n              <Route path='/api'>\n                <Api />\n              </Route>\n              <Route path='/example'>\n                <Examples />\n              </Route>\n              <Route path='/'>\n                <Home />\n              </Route>\n            </Switch>\n          </div>\n        </Content>\n      </Layout>\n    </Layout>\n  )\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport 'antd/dist/antd.css'\nimport App from './pages/App'\nimport { HashRouter as Router } from 'react-router-dom'\n\nReactDOM.render(\n  <Router hashType='noslash'>\n    <App />\n  </Router>,\n  document.getElementById('root')\n)\n"],"sourceRoot":""}